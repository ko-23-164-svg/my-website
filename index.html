<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>BaaS Dashboard</title>
    <style>
    body { 
        font-family: 'Inter', sans-serif; 
        background: #f4f7f6; 
        display: flex; 
        flex-direction: column; 
        align-items: center; 
        padding: 20px; 
        margin: 0;
    }
    .container { 
        width: 100%; 
        max-width: 500px; 
        background: white; 
        padding: 25px; 
        border-radius: 12px; 
        box-shadow: 0 4px 15px rgba(0,0,0,0.05); 
    }
    h3 { 
        margin-top: 0; 
        color: #1a1a1a; 
        font-weight: 600; 
    }
    input { 
        width: 100%; 
        padding: 12px; 
        margin: 8px 0; 
        border: 1px solid #ddd; 
        border-radius: 6px; 
        box-sizing: border-box; 
        font-size: 14px;
    }
    input:focus { 
        outline: none; 
        border-color: #007bfe; 
    }
    button#mainBtn { 
        background: #007bfe; 
        color: white; 
        border: none; 
        padding: 12px; 
        border-radius: 6px; 
        width: 100%; 
        font-weight: 600; 
        cursor: pointer; 
        transition: 0.3s ease-in-out; 
        font-size: 14px;
        margin-top: 8px;
    }
    button#mainBtn:hover { 
        background: #0056b3; 
    }
    button#mainBtn:disabled { 
        background: #ccc; 
        cursor: not-allowed; 
    }
    .post { 
        background: white; 
        border: 1px solid #eaeaea; 
        padding: 15px; 
        margin-top: 15px; 
        border-radius: 8px; 
        width: 100%; 
        max-width: 500px; 
        position: relative; 
        box-shadow: 0 2px 8px rgba(0,0,0,0.02);
        transition: 0.2s;
    }
    .post:hover {
        box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }
    .like-btn { 
        cursor: pointer; 
        border: 1px solid #e0e0e0; 
        background: #f8f9fa; 
        padding: 6px 15px; 
        border-radius: 20px; 
        font-size: 14px; 
        transition: 0.2s; 
        display: inline-flex;
        align-items: center;
        gap: 5px;
        margin-top: 10px;
    }
    .like-btn:hover { 
        background: #fee; 
        border-color: #ff6b6b; 
    }
    .time { 
        font-size: 11px; 
        color: #999; 
        float: right; 
        background: #f5f5f5;
        padding: 3px 8px;
        border-radius: 12px;
    }
    .post b {
        color: #2c3e50;
        font-size: 16px;
    }
    .post p {
        color: #666;
        margin: 8px 0;
        word-break: break-all;
    }
    #feed {
        width: 100%;
        max-width: 500px;
    }
    .stats {
        font-size: 12px;
        color: #888;
        margin-top: 5px;
    }
    </style>
</head>
<body>

<div class="container">
    <h3>üìä –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã–º–∏</h3>
    <input type="text" id="name" placeholder="–ò–º—è –ø—Ä–æ—Ñ–∏–ª—è" autocomplete="off">
    <input type="email" id="email" placeholder="–†–∞–±–æ—á–∏–π Email" autocomplete="off">
    <button id="mainBtn">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>

<div id="feed"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
import {
    getFirestore, collection, addDoc, query, orderBy, onSnapshot,
    serverTimestamp, updateDoc, doc, increment
} from "https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore.js";

// –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø FIREBASE
const firebaseConfig = {
  apiKey: "AIzaSyAS1I_u_zQhjjEgZedrgCgy6S_LUaIF1q8",
  authDomain: "gjgy-5930b.firebaseapp.com",
  projectId: "gjgy-5930b",
  storageBucket: "gjgy-5930b.firebasestorage.app",
  messagingSenderId: "401653343249",
  appId: "1:401653343249:web:60fbdb5cef88a9c1b4bdb0",
  measurementId: "G-VVP7H6TBHZ"
};

// –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø FIREBASE
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

////////////////////////////////////////////////////////////
// 1Ô∏è‚É£ –§–£–ù–ö–¶–ò–Ø –£–î–ê–õ–ï–ù–ò–Ø
////////////////////////////////////////////////////////////
window.deleteRequest = async (id) => {
    if (!confirm("–£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å?")) return;

    try {
        await deleteDoc(doc(db, "requests", id));
    } catch (error) {
        console.error("–û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è:", error);
        alert("–ù–µ —É–¥–∞–ª–æ—Å—å —É–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å");
    }
};

////////////////////////////////////////////////////////////
// 2Ô∏è‚É£ –§–£–ù–ö–¶–ò–Ø –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø
////////////////////////////////////////////////////////////
window.editRequest = async (id, currentName) => {
    const newName = prompt("–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤–æ–µ –∏–º—è:", currentName);

    if (!newName || newName.trim().length <= 2) {
        alert("–ò–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –¥–ª–∏–Ω–Ω–µ–µ 2 —Å–∏–º–≤–æ–ª–æ–≤");
        return;
    }

    try {
        await updateDoc(doc(db, "requests", id), {
            name: newName.trim()
        });
    } catch (error) {
        console.error("–û—à–∏–±–∫–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:", error);
        alert("–ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å –∑–∞–ø–∏—Å—å");
    }
};

////////////////////////////////////////////////////////////
// –õ–ê–ô–ö
////////////////////////////////////////////////////////////
window.processLike = async (id) => {
    const docRef = doc(db, "requests", id);
    try {
        await updateDoc(docRef, { 
            likes: increment(1) 
        });
    } catch (error) {
        console.error("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏:", error);
        alert("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ—Å—Ç–∞–≤–∏—Ç—å –ª–∞–π–∫");
    }
};

////////////////////////////////////////////////////////////
// –î–û–ë–ê–í–õ–ï–ù–ò–ï –ó–ê–ü–ò–°–ò
////////////////////////////////////////////////////////////
document.getElementById('mainBtn').onclick = async () => {
    const btn = document.getElementById('mainBtn');
    const nameInput = document.getElementById('name');
    const emailInput = document.getElementById('email');
    
    if (nameInput.value.length <= 2) {
        alert("–ò–º—è –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –¥–ª–∏–Ω–Ω–µ–µ 2 —Å–∏–º–≤–æ–ª–æ–≤");
        return;
    }
    if (!emailInput.value.includes('@')) {
        alert("–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π email");
        return;
    }
    
    btn.disabled = true;
    btn.textContent = "‚è≥ –û—Ç–ø—Ä–∞–≤–∫–∞...";
    
    try {
        await addDoc(collection(db, "requests"), {
            name: nameInput.value.trim(),
            email: emailInput.value.trim(),
            likes: 0,
            timestamp: serverTimestamp()
        });
        
        nameInput.value = "";
        emailInput.value = "";
        
    } catch (e) { 
        console.error("–û—à–∏–±–∫–∞ Firestore:", e);
        alert("‚ùå –û—à–∏–±–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏: –î–∞–Ω–Ω—ã–µ –æ—Ç–∫–ª–æ–Ω–µ–Ω—ã —Å–µ—Ä–≤–µ—Ä–æ–º."); 
    }
    
    btn.disabled = false;
    btn.textContent = "‚ûï –î–æ–±–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å—å";
};

////////////////////////////////////////////////////////////
// REAL-TIME –°–ò–ù–•–†–û–ù–ò–ó–ê–¶–ò–Ø
////////////////////////////////////////////////////////////
const q = query(collection(db, "requests"), orderBy("timestamp", "desc"));

onSnapshot(q, (snapshot) => {
    const feed = document.getElementById('feed');
    feed.innerHTML = '';
    
    if (snapshot.empty) {
        feed.innerHTML = '<div class="post" style="text-align: center; color: #999;">üì≠ –ù–µ—Ç –∑–∞–ø–∏—Å–µ–π</div>';
        return;
    }
    
    snapshot.forEach((docItem) => {
        const data = docItem.data();
        const postId = docItem.id;
        
        const timeString = data.timestamp 
            ? data.timestamp.toDate().toLocaleString('ru-RU', { 
                hour: '2-digit', 
                minute: '2-digit',
                day: '2-digit',
                month: '2-digit'
              })
            : '—Ç–æ–ª—å–∫–æ —á—Ç–æ';
        
        feed.innerHTML += `
            <div class="post" id="post-${postId}">
                <span class="time">üïê ${timeString}</span>
                <b>${data.name || '–ë–µ–∑ –∏–º–µ–Ω–∏'}</b>
                <p>üìß ${data.email || '–ù–µ—Ç email'}</p>

                <div style="margin-top:10px; display:flex; gap:8px;">
                    <button class="like-btn" onclick="processLike('${postId}')">
                        ‚ù§Ô∏è ${data.likes || 0}
                    </button>
                    <button class="like-btn" onclick="editRequest('${postId}', '${data.name}')">
                        ‚úèÔ∏è
                    </button>
                    <button class="like-btn" onclick="deleteRequest('${postId}')">
                        üóë
                    </button>
                </div>
            </div>
        `;
    });
}, (error) => {
    console.error("–û—à–∏–±–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏:", error);
    document.getElementById('feed').innerHTML = '<div class="post" style="text-align: center; color: red;">‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</div>';
});

// –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–û: –æ—á–∏—Å—Ç–∫–∞ –ø–æ Enter
document.getElementById('email').addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
        document.getElementById('mainBtn').click();
    }
});

console.log("‚úÖ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—â–µ–Ω–æ");
</script>

</body>
</html>
